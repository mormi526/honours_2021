###Pulling out JAZF1 region ~1Mb from newest version of Variant Bio data

bcftools view -r chr7:27492746-28512946 -m 2 -M 2 -v snps JG-NZ01-WGS-LP-8.merge.recal.imputed.gq18.v1.2.vcf.gz > (serverlocation)/JAZF1_region_VB.vcf


####Converting the vcd file to bed, bio and fam


plink1.9b6.10 --vcf JAZF1_region_VB.vcf --make-bed --out JAZF1_region

###annotating the missing SNP column in the bed, bio and fam files with chrom_pos

plink1.9b6.10 --bfile JAZF1_region --set-missing-var-ids @_#_\$1_\$2 --make-bed --out new_JAZF1

###carrying out association analyses (logistic) on SNPs in JAZF1 region in M/P participants. Adjustments (--covar-name) for age, sex all 10 PCs (from the CoreExome data). --covar file and --pheno file are the same (generated by Megan p[reviously, of everyone included in the variant bio dataset). SNPs are excluded if HWE is p < 1e-06 (--hwe 1e-06) and MAF lower than 0.01 (in M/P) (--maf 0.01)  and genotyping call rate less than 95% (--geno 0.05), using the phenotype file previously generated by Megan (variant_bio_pheno.txt). 
##--allow-no-sex means ignore the fact that there is no sex info in the fam file instead take it from covar file. 
##--hide-covar means don't print the associations with the covariates (adjustments).

plink1.9b6.10 --bfile new_JAZF1 --ci 0.95 --covar variant_bio_pheno.txt --covar-name Pheno.Age,Pheno.Gender,Geno.PCVector1-Geno.PCVector10 --logistic --out JAZF1_new --maf 0.01 --hwe 1e-06 --geno 0.05 --pheno variant_bio_pheno.txt --pheno-name DIABETES --allow-no-sex --hide-covar


#generate LD file for each of the SNPs we are interested in:

plink1.9b6.10 --bfile new_JAZF1 --ld-snp chr7_27848187_C_G --ld-window 1000000 --ld-window-kb 1000000 --ld-window-r2 0 --out JAZF1_lead --r2

plink1.9b6.10 --bfile new_JAZF1 --ld-snp chr7_28020670_C_T --ld-window 1000000 --ld-window-kb 1000000 --ld-window-r2 0 --out JAZF1_MP --r2



#drawing up the locus zooms using a custom script downloadable from here:
#https://github.com/Geeketics/LocusZooms

#And see here:
#https://merrimanlab.github.io/docs/locuszooms/generating_single_locus_zooms/


#first load in your association file from up above

Example.assoc.linear <- read.table("JAZF1_new.assoc.logistic", sep = '', stringsAsFactors = FALSE, header = TRUE)

#then load in your LD file depending on which snp you want to do the correlation for I.e. to generate the four different plots you need to run this 4 times with the different files


#Example.ld <- read.table("JAZF1_MP.ld", stringsAsFactors = FALSE, header = TRUE)
#Example.ld <- read.table("JAZF1_lead.ld", stringsAsFactors = FALSE, header = TRUE)


UCSC_GRCh37_Genes_UniqueList.txt <- read.delim("LocusZooms-scale/Gencode_GRCh37_Genes_UniqueList2021.txt", stringsAsFactors = FALSE, header = TRUE)

# Load the locuszoom function into R
source("LocusZooms-scale/functions/locus_zoom.R")

# Create a LocusZoom-like plot
locus.zoom(data = Example.assoc.linear,
           region = c(7, 27493492, 28512759),
           offset_bp = 0,
           ld.file = Example.ld,
           genes.data = UCSC_GRCh37_Genes_UniqueList.txt,
           plot.title = "Association of JAZF1 with diabetes in M/P",
           #file.name = "Example.jpg",
           #file.name = "Example_2nd.jpg",
           #file.name = "Example_3rd.jpg",
           #file.name = "Example_MP.jpg",
           rsid.check = F)
